<!-- templates/index.html ‚Äî BusSight ‚Ä¢ UI principal (pt-BR) -->
<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BusSight ‚Ä¢ Contagem de pessoas</title>
  <link rel="stylesheet" href="/static/styles.css" />
  <style>
    /* Overrides visuais para o print de exemplo */
    .pill{display:inline-flex;gap:.5rem;align-items:center;border-radius:999px;padding:.25rem .75rem;font-weight:600}
    .pill.in{background:#eaf7ef;color:#137a3a;border:1px solid #cfead7}         /* verde */
    .pill.out{background:#fdeaea;color:#b81f2b;border:1px solid #f3c8cc}        /* vermelho */
    .pill.total{background:#f3f3f3;color:#0b1220;border:1px solid #e1e1e1}      /* preto */
    .downloads a{display:inline-block;margin:.25rem .5rem .25rem 0;text-decoration:none}
    .downloads .btn{border:1px solid #d0d4da;border-radius:10px;padding:.4rem .7rem}
    .downloads .btn.ghost{background:#f7f9fc}
    .table-wrap tfoot td{font-weight:700;border-top:2px solid #d0d4da}
    .status{font-weight:600}
    .totals{display:flex;gap:1.5rem;flex-wrap:wrap;margin:.5rem 0 1rem}
    .totals p{margin:0}
  </style>
</head>
<body class="bg">
  <header class="topbar">
    <div class="container brand">
      <img src="/static/design.svg" alt="BusSight" class="brand-logo" />
      <div>
        <h1>BusSight ‚Ä¢ Contagem de pessoas</h1>
        <small>Entradas e sa√≠das por linha virtual</small>
      </div>
    </div>
  </header>

  <main class="container grid">
    <!-- Painel de upload / par√¢metros -->
    <section class="card">
      <h2>V√≠deo e Par√¢metros</h2>

      <!-- Upload -->
      <div id="dropArea" class="drop">
        <input type="file" id="video" accept=".mp4,.avi,.mkv,.mov" />
        <p>Arraste e solte o v√≠deo aqui, ou clique para selecionar.</p>
      </div>

      <!-- Preview + linha -->
      <div class="player">
        <video id="videoPreview" controls playsinline></video>
        <canvas id="overlay"></canvas>
      </div>

      <!-- Linha (inputs exigidos, sempre normalizados 0‚Äì1) -->
      <div class="line-grid">
        <label>X1 <input id="x1" type="number" min="0" max="1" step="0.001" value="0.2"></label>
        <label>Y1 <input id="y1" type="number" min="0" max="1" step="0.001" value="0.8"></label>
        <label>X2 <input id="x2" type="number" min="0" max="1" step="0.001" value="0.8"></label>
        <label>Y2 <input id="y2" type="number" min="0" max="1" step="0.001" value="0.8"></label>
      </div>

      <!-- Par√¢metros de processamento -->
      <div class="param-grid">
        <label>sample_fps <input id="sample_fps" type="number" step="0.1" value="5.0"></label>
        <label>chunk_seconds <input id="chunk_seconds" type="number" step="1" value="60"></label>
        <label>workers <input id="workers" type="number" step="1" value="0"></label>
        <label class="chk"><input id="save_annotated" type="checkbox" checked>Salvar v√≠deo anotado</label>
      </div>

      <!-- A√ß√µes -->
      <div class="actions">
        <button id="btnProcess" class="btn">Processar</button>
        <button id="btnStream" class="btn ghost">Processar (Streaming)</button>
        <span id="status" class="status" role="progressbar" aria-valuemin="0" aria-valuemax="100">Pronto</span>
      </div>
    </section>

    <!-- Resultados -->
    <section class="card">
      <h2>Resultados</h2>
      <div class="numbers">
        <span class="pill in">IN <strong id="inCount">0</strong></span>
        <span class="pill out">OUT <strong id="outCount">0</strong></span>
        <span class="pill total">TOTAL <strong id="totalCount">0</strong></span>
      </div>

      <!-- Totais destacados (tamb√©m para print) -->
      <div class="totals">
        <p><strong>Total IN:</strong> <span style="color:#137a3a;" id="sumInTop">0</span></p>
        <p><strong>Total OUT:</strong> <span style="color:#b81f2b;" id="sumOutTop">0</span></p>
        <p><strong>Total MOVIMENTA√á√ïES:</strong> <span style="color:#0b1220;" id="sumMovTop">0</span></p>
      </div>

      <div id="downloads" class="downloads"></div>

      <div class="windows">
        <h3>Janelas agregadas</h3>
        <div class="table-wrap">
          <table>
            <thead>
              <tr><th>In√≠cio</th><th>Fim</th><th>IN</th><th>OUT</th><th>TOTAL</th></tr>
            </thead>
            <tbody id="windowsTable"></tbody>
            <tfoot>
              <tr>
                <td colspan="2">Total</td>
                <td id="totalIn"><strong>0</strong></td>
                <td id="totalOut"><strong>0</strong></td>
                <td id="totalMov"><strong>0</strong></td>
              </tr>
            </tfoot>
          </table>
        </div>
      </div>
    </section>

    <!-- Calculadora lateral -->
    <aside class="calc-card">
      <h2>Calculadora de Custo</h2>

      <h3>Micro</h3>
      <div class="calc-grid">
        <label>Pre√ßo/Litro <input id="precoLitro" type="number" step="0.01" value="6.00"></label>
        <label>KM rodados <input id="kmRodadosMicro" type="number" step="1" value="3000"></label>
        <label>Litros/KM <input id="litrosPorKmMicro" type="number" step="0.0001" value="0.12"></label>
        <label>Custo/KM manuten√ß√£o <input id="custoPorKmManutencaoMicro" type="number" step="0.01" value="0.40"></label>
      </div>
      <div class="calc-box">
        <button class="btn" onclick="calcularMicro()">Calcular Micro</button>
        <p>Consumo total: <strong id="consumoTotalMicro">0</strong> L</p>
        <p>Custo combust√≠vel: <strong id="custoTotalCombustivelMicro">R$ 0,00</strong></p>
        <p>Custo/KM: <strong id="custoPorKmMicro">R$ 0,00</strong></p>
        <p>Custo total: <strong id="custoTotalMicro">R$ 0,00</strong></p>
      </div>

      <h3>Mid</h3>
      <div class="calc-grid">
        <label>Pre√ßo/Litro <input id="precoLitroMid" type="number" step="0.01" value="6.00"></label>
        <label>KM rodados <input id="kmRodadosMid" type="number" step="1" value="3000"></label>
        <label>Litros/KM <input id="litrosPorKmMid" type="number" step="0.0001" value="0.18"></label>
        <label>Custo/KM manuten√ß√£o <input id="custoPorKmManutencaoMid" type="number" step="0.01" value="0.55"></label>
      </div>
      <div class="calc-box">
        <button class="btn" onclick="calcularMid()">Calcular Mid</button>
        <p>Consumo total: <strong id="consumoTotalMid">0</strong> L</p>
        <p>Custo combust√≠vel: <strong id="custoTotalCombustivelMid">R$ 0,00</strong></p>
        <p>Custo/KM: <strong id="custoPorKmMid">R$ 0,00</strong></p>
        <p>Custo total: <strong id="custoTotalMid">R$ 0,00</strong></p>
      </div>
    </aside>
  </main>

  <div id="toasts"></div>

  <script src="/static/app.js"></script>

  <!-- MOCK DATA para print -->
  <script>
    (function(){
      // Contagens gerais (exemplo)
      const inTotal  = 37;
      const outTotal = 29;
      const movTotal = inTotal + outTotal;

      // Topo (pills)
      document.getElementById('inCount').textContent     = inTotal;
      document.getElementById('outCount').textContent    = outTotal;
      document.getElementById('totalCount').textContent  = movTotal;

      // Totais destacados logo abaixo
      document.getElementById('sumInTop').textContent  = inTotal;
      document.getElementById('sumOutTop').textContent = outTotal;
      document.getElementById('sumMovTop').textContent = movTotal;

      // Status conclu√≠do
      const status = document.getElementById('status');
      status.textContent = 'Conclu√≠do ‚Ä¢ 100%';

      // Downloads de exemplo
      const downloads = document.getElementById('downloads');
      downloads.innerHTML = `
        <a href="#" class="btn">üì• Anotado (MP4)</a>
        <a href="#" class="btn ghost">üìä Relat√≥rio (CSV)</a>
        <a href="#" class="btn ghost">üßæ Sum√°rio (PDF)</a>
      `;

      // Janelas agregadas (exemplo)
      const rows = [
        {ini:'08:00:00', fim:'08:15:59', IN:12, OUT:7},
        {ini:'08:16:00', fim:'08:31:59', IN:15, OUT:10},
        {ini:'08:32:00', fim:'08:47:59', IN:10, OUT:12}
      ];
      const tbody = document.getElementById('windowsTable');
      tbody.innerHTML = rows.map(r => {
        const total = r.IN + r.OUT;
        return `<tr><td>${r.ini}</td><td>${r.fim}</td><td>${r.IN}</td><td>${r.OUT}</td><td>${total}</td></tr>`;
      }).join('');

      // Totais do rodap√©
      const sumIn   = rows.reduce((a,b)=>a+b.IN,0);
      const sumOut  = rows.reduce((a,b)=>a+b.OUT,0);
      const sumMov  = rows.reduce((a,b)=>a+b.IN+b.OUT,0);

      document.getElementById('totalIn').innerHTML  = `<strong>${sumIn}</strong>`;
      document.getElementById('totalOut').innerHTML = `<strong>${sumOut}</strong>`;
      document.getElementById('totalMov').innerHTML = `<strong>${sumMov}</strong>`;

      // Pr√©-preencher um frame de preview para o print (opcional)
      const video = document.getElementById('videoPreview');
      video.poster = '/static/preview-frame.jpg'; // se n√£o existir, ignora
    })();
  </script>
</body>
</html>
